<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{fragments/layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据导入导出 - 图书管理系统</title>
    <style>
        .card {
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        .card-header {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        .btn-primary {
            background-color: #0d6efd;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
        }
        .btn-secondary {
            background-color: #6c757d;
            border: none;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .file-upload-area {
            border: 2px dashed #ced4da;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
        }
        .file-upload-area:hover {
            border-color: #0d6efd;
            background-color: #e9ecef;
        }
        .file-upload-icon {
            font-size: 3rem;
            color: #6c757d;
            margin-bottom: 15px;
        }
        .file-upload-text {
            color: #6c757d;
            margin-bottom: 10px;
        }
        .file-upload-hint {
            font-size: 0.9rem;
            color: #adb5bd;
        }
        .form-check-label {
            font-weight: normal;
        }
        .alert {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div layout:fragment="content">
        <div class="container-fluid">
            <h1 class="mb-4">数据导入导出</h1>
            
            <!-- 消息提示 -->
            <div th:if="${successMessage}" class="alert alert-success">
                <i class="fa fa-check-circle"></i> <span th:text="${successMessage}">操作成功！</span>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger">
                <i class="fa fa-exclamation-circle"></i> <span th:text="${errorMessage}">操作失败，请重试。</span>
            </div>
            
            <!-- 数据导入 -->
            <div class="card">
                <div class="card-header">
                    <i class="fa fa-upload mr-2"></i>数据导入
                </div>
                <div class="card-body">
                    <h5 class="card-title mb-4">图书数据导入</h5>
                    <form th:action="@{/data/import}" method="post" enctype="multipart/form-data">
                        <!-- 文件上传区域 -->
                        <div class="file-upload-area mb-4">
                            <div class="file-upload-icon">
                                <i class="fa fa-file-text-o"></i>
                            </div>
                            <div class="file-upload-text">
                                <p>拖放文件到此处，或点击选择文件</p>
                            </div>
                            <div class="file-upload-hint">
                                <p>支持 .xlsx, .xls, .csv 格式文件</p>
                                <p class="text-danger">文件大小请勿超过 10MB</p>
                            </div>
                            <input type="file" name="file" accept=".xlsx,.xls,.csv" class="mt-3" required>
                        </div>
                        
                        <!-- 导入选项 -->
                        <div class="mb-4">
                            <h6 class="mb-2">导入选项：</h6>
                            <div class="form-check mb-2">
                                <input type="checkbox" id="override" name="override" class="form-check-input">
                                <label for="override" class="form-check-label">覆盖已存在的图书数据</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="createCategories" name="createCategories" class="form-check-input" checked>
                                <label for="createCategories" class="form-check-label">自动创建不存在的分类</label>
                            </div>
                        </div>
                        
                        <!-- 操作按钮 -->
                        <div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fa fa-upload mr-2"></i>开始导入
                            </button>
                            <a th:href="@{/data/download-template}" class="btn btn-secondary ml-2">
                                <i class="fa fa-download mr-2"></i>下载导入模板
                            </a>
                        </div>
                    </form>
                    
                    <!-- 导入说明 -->
                    <div class="mt-4 p-3 bg-light rounded">
                        <h6>导入说明：</h6>
                        <ul class="list-unstyled">
                            <li><i class="fa fa-info-circle text-primary mr-2"></i>Excel 模板包含以下列：书名、作者、ISBN、出版社、出版日期、分类、价格、数量、简介</li>
                            <li><i class="fa fa-info-circle text-primary mr-2"></i>CSV 文件请使用 UTF-8 编码，第一行为列标题</li>
                            <li><i class="fa fa-info-circle text-primary mr-2"></i>导入过程可能需要几分钟，请耐心等待</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- 数据导出 -->
            <div class="card">
                <div class="card-header">
                    <i class="fa fa-download mr-2"></i>数据导出
                </div>
                <div class="card-body">
                    <h5 class="card-title mb-4">导出数据</h5>
                    <form th:action="@{/data/export}" method="post">
                        <!-- 导出内容选择 -->
                        <div class="mb-4">
                            <h6 class="mb-2">导出内容：</h6>
                            <div class="form-check mb-2">
                                <input type="radio" id="exportBooks" name="exportType" value="BOOKS" class="form-check-input" checked>
                                <label for="exportBooks" class="form-check-label">图书数据</label>
                            </div>
                            <div class="form-check mb-2">
                                <input type="radio" id="exportUsers" name="exportType" value="USERS" class="form-check-input">
                                <label for="exportUsers" class="form-check-label">用户数据</label>
                            </div>
                            <div class="form-check mb-2">
                                <input type="radio" id="exportBorrows" name="exportType" value="BORROW_RECORDS" class="form-check-input">
                                <label for="exportBorrows" class="form-check-label">借阅记录</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" id="exportAll" name="exportType" value="ALL" class="form-check-input">
                                <label for="exportAll" class="form-check-label">全部数据（分别导出为多个文件）</label>
                            </div>
                        </div>
                        
                        <!-- 导出格式选择 -->
                        <div class="mb-4">
                            <h6 class="mb-2">导出格式：</h6>
                            <div class="form-check mb-2">
                                <input type="radio" id="formatExcel" name="format" value="EXCEL" class="form-check-input" checked>
                                <label for="formatExcel" class="form-check-label">Excel (.xlsx)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" id="formatCsv" name="format" value="CSV" class="form-check-input">
                                <label for="formatCsv" class="form-check-label">CSV (.csv)</label>
                            </div>
                        </div>
                        
                        <!-- 图书导出选项 -->
                        <div class="mb-4" id="bookOptions">
                            <h6 class="mb-2">图书导出选项：</h6>
                            <div class="form-check mb-2">
                                <input type="checkbox" id="includeInactive" name="includeInactive" class="form-check-input">
                                <label for="includeInactive" class="form-check-label">包含已下架图书</label>
                            </div>
                        </div>
                        
                        <!-- 操作按钮 -->
                        <div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fa fa-download mr-2"></i>开始导出
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 显示/隐藏图书导出选项
            const exportTypeRadios = document.querySelectorAll('input[name="exportType"]');
            const bookOptions = document.getElementById('bookOptions');
            
            function updateBookOptionsVisibility() {
                const selectedExportType = document.querySelector('input[name="exportType"]:checked').value;
                bookOptions.style.display = (selectedExportType === 'BOOKS' || selectedExportType === 'ALL') ? 'block' : 'none';
            }
            
            exportTypeRadios.forEach(radio => {
                radio.addEventListener('change', updateBookOptionsVisibility);
            });
            
            // 初始化显示状态
            updateBookOptionsVisibility();
        });
    </script>
</body>
</html>